!function(t){"use strict";function e(e,a,n){e.find(".ngl-article-featured img").prop("src");var l={action:"newsletterglue_save_article_image",key:a,ids:n,security:newsletterglue_params.ajaxnonce};t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:l,success:function(t){t?(e.find(".ngl-article-featured img").prop("src",t.data.url),e.attr("data-attachment",t.data.id),e.find(".ngl-article-featured-edit i.trash").show()):(e.find(".ngl-article-featured img").prop("src",e.find(".ngl-article-featured img").attr("data-original-src")),e.attr("data-attachment",""),e.find(".ngl-article-featured-edit i.trash").hide())}})}function a(e){e.find(".ngl-article-list-item").each(function(){var a=e.find(".ngl-article-list-item"),n=a.length-a.index(t(this));t(this).attr("data-key",n)}),e.find(".ngl-articles-wrap .ngl-article:visible").each(function(){var a=e.find(".ngl-article:visible"),n=a.length-a.index(t(this));t(this).attr("data-key",n)});var a=e.attr("data-block-id"),n=[],l=[];e.find(".ngl-article-list-item").each(function(){var e=t(this).attr("data-key"),a=t(this).attr("data-post-id");n.push(e),l.push(a)});var i="action=newsletterglue_ajax_order_articles&security="+newsletterglue_params.ajaxnonce+"&block_id="+a+"&keys="+n+"&values="+l;t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:i})}function n(e){var a=e.parents(".ngl-embed").find(".ngl-embed-content"),n=e.parents(".ngl-embed").attr("data-block-id"),l=e.val(),i="action=newsletterglue_ajax_get_embed&security="+newsletterglue_params.ajaxnonce+"&block_id="+n+"&url="+encodeURIComponent(l);t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:i,beforeSend:function(){a.empty()},success:function(t){t.error&&a.html('<div class="ngl-embed-error">'+t.error+"</div>"),t.html&&a.html(t.html)}})}if(t(document).on("mouseenter",".ngl-article-featured",function(){var e=t(this).find(".ngl-article-featured-edit"),a=t(this).find("img");a.attr("src")==a.attr("data-original-src")?e.find("i.trash").hide():e.find("i.trash").show()}),t(document).on("click",".ngl-article-featured-edit i.image.outline.icon",function(a){var n,l;return a.preventDefault(),n=t(this).parents(".ngl-article"),l&&l.open(),(l=wp.media({title:newsletterglue_params.select_image,multiple:!1,library:{type:"image"}})).on("close",function(){var t=l.state().get("selection"),a=new Array,i=0;t.each(function(t){a[i]=t.id,i++});var r=a.join(",");n.attr("data-attachment",r),e(n,n.attr("data-post-id"),r)}),l.on("open",function(){var t=l.state().get("selection"),e=n.attr("data-attachment")?n.attr("data-attachment").split(","):"";e&&e.forEach(function(e){if(e){var a=wp.media.attachment(e);a.fetch(),t.add(a?[a]:[])}})}),l.open(),!1}),t(document).on("click",".ngl-article-featured-edit i.trash.outline.icon",function(a){return a.preventDefault(),e(t(this).parents(".ngl-article"),t(this).parents(".ngl-article").attr("data-post-id"),""),!1}),t(document).on("change","#ngl_embed_url",function(e){n(t(this))}),t(document).on("keyup","#ngl_embed_url",function(e){"Enter"!==e.key&&13!==e.keyCode||n(t(this))}),t(".ngl-embed-url").length)setInterval(function(){t(".ngl-embed-url").each(function(){var e=t(this),a=t(this).parents(".ngl-embed").find(".ngl-embed-content"),n=t(this).parents(".ngl-embed").find(".ngl-embed-error");""==e.val()||n.length||t.trim(a.html()).length||e.trigger("change")})},500);t(document).on("submit",".ngl-article-add",function(e){return e.preventDefault(),function(e){var a=e.attr("data-block-id"),n=e.attr("data-date_format"),l=e.find(".ngl_article_s").attr("data-post"),i=e.find(".ngl-article-placeholder");l||(l=e.find(".ngl_article_s").val());var r=e.find(".ngl-article-list-wrap");if(r.find(".ngl-article-list-item").length)var s=parseInt(r.find(".ngl-article-list-item").first().attr("data-key"))+1;else s=1;var c="action=newsletterglue_ajax_add_article&security="+newsletterglue_params.ajaxnonce+"&block_id="+a+"&key="+s+"&thepost="+encodeURIComponent(l)+"&date_format="+encodeURIComponent(n);t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:c,beforeSend:function(){e.find(".ngl-articles-add .ngl-article-status").removeClass("ngl-article-error ngl-article-success").empty()},success:function(t){if(t.error&&(e.find(".ngl-articles-add .ngl-article-status").addClass("ngl-article-error").html(t.error),e.find(".ngl_article_s").focus()),t.key){e.find(".ngl-articles-add .ngl-article-status").addClass("ngl-article-success").html(t.success),e.find(".ngl_article_s").val("").attr("data-post","");var a=i.clone();a.html(a.html().replace("{excerpt}",t.excerpt)),a.html(a.html().replace("{labels}",t.labels)),a.html(a.html().replace("{title}",t.title)),a.html(a.html().replace("{permalink}",t.permalink)),a.html(a.html().replace("{date}",t.date)),a.html(a.html().replace("{featured_image}",t.featured_image)),a.attr("data-post-id",t.post_id),a.attr("data-key",t.key),a.find(".ngl-article-featured a").attr("href",t.permalink),a.find(".ngl-article-featured img").attr("data-original-src",t.featured_image),a.prependTo(e.find(".ngl-articles-wrap")).removeClass("ngl-article-placeholder"),e.find(".ngl-article-list-empty").length&&e.find(".ngl-article-list-empty").hide(),e.find(".ngl-article-list-wrap").prepend(t.item),e.find(".ngl-article-list-empty").remove()}}})}(t(this).parents(".ngl-articles")),!1}),t(document).on("focus",".ngl-article-labels[contenteditable]",function(){const e=t(this);e.data("before",e.html()),e.html()==newsletterglue_params.write_labels&&e.html("")}).on("blur keyup paste input",".ngl-article-labels[contenteditable]",function(){const e=t(this);e.data("before")!==e.html()&&(e.data("before",e.html()),e.trigger("change"))}).on("blur",".ngl-article-labels[contenteditable]",function(){const e=t(this);""==e.html()&&e.html(newsletterglue_params.write_labels)}),t(document).on("change",".ngl-article-labels[contenteditable]",function(){var e=t(this).parents(".ngl-article").attr("data-post-id"),a=t(this).html(),n="action=newsletterglue_ajax_update_labels&security="+newsletterglue_params.ajaxnonce+"&post_id="+e+"&labels="+encodeURIComponent(a);t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:n})}),t(document).on("focus",".ngl-article-excerpt[contenteditable]",function(){const e=t(this);e.data("before",e.html())}).on("blur keyup paste input",".ngl-article-excerpt[contenteditable]",function(){const e=t(this);e.data("before")!==e.html()&&(e.data("before",e.html()),e.trigger("change"))}),t(document).on("change",".ngl-article-excerpt[contenteditable]",function(){var e=t(this).parents(".ngl-article").attr("data-post-id"),a=t(this).html(),n="action=newsletterglue_ajax_update_excerpt&security="+newsletterglue_params.ajaxnonce+"&post_id="+e+"&excerpt="+encodeURIComponent(a);t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:n})}),t(document).on("click",".ngl-article-title a",function(t){return t.preventDefault(),!1}),t(document).on("focus",".ngl-article-title span[contenteditable]",function(){const e=t(this);e.data("before",e.html())}).on("blur keyup paste input",".ngl-article-title span[contenteditable]",function(){const e=t(this);e.data("before")!==e.html()&&(e.data("before",e.html()),e.trigger("change"))}),t(document).on("change",".ngl-article-title span[contenteditable]",function(){var e=t(this).parents(".ngl-articles"),a=t(this).parents(".ngl-article").attr("data-post-id"),n=t(this).parents(".ngl-article").attr("data-key"),l=t(this).html(),i="action=newsletterglue_ajax_update_title&security="+newsletterglue_params.ajaxnonce+"&post_id="+a+"&title="+encodeURIComponent(l);e.find(".ngl-article-list-item[data-key="+n+"] .ngl-article-list-title").html(l),t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:i})});var l="";t(document).on("blur input keyup change",".ngl_article_s",function(){var e=t(this).val(),a=t(this).parents(".ngl-article-add").find(".ngl-article-suggest"),n="action=newsletterglue_ajax_search_articles&security="+newsletterglue_params.ajaxnonce+"&term="+encodeURIComponent(e);return function(t){let e;try{e=new URL(t)}catch(t){return!1}return"http:"===e.protocol||"https:"===e.protocol}(e)?(a.hide().empty(),l=null,!1):e.length<3?(a.hide().empty(),l=null,!1):l!=e&&(l=e,void t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:n,success:function(t){t.html?a.show().html(t.html):a.hide().empty()}}))}),t(document).on("click",".ngl-article-suggest li a",function(e){e.preventDefault();var a=t(this).parents(".ngl-article-add"),n=t(this).attr("data-post-id");return a.find(".ngl_article_s").val(t(this).html()).attr("data-post",n),a.find(".ngl-article-suggest").empty().hide(),a.trigger("submit"),!1}),t(document).on("click",".ngl-article-list-head",function(e){e.preventDefault();var a=t(this).parent().find(".ngl-article-list-wrap");return a.is(":visible")?(t(this).find("span").html("expand_less"),a.hide()):(t(this).find("span").html("expand_more"),a.show()),!1}),t(document).on("click",".ngl-article-list-refresh",function(e){e.preventDefault();var a=t(this),n=t(this).html(),l=t(this).parents(".ngl-article-list-wrap"),i=t(this).parents(".ngl-article-list-item"),r=t(this).parents(".ngl-articles").attr("data-block-id"),s=i.attr("data-key"),c=i.attr("data-post-id"),d=t(this).parents(".ngl-articles").find(".ngl-article[data-key="+s+"]"),o="action=newsletterglue_ajax_clear_cache&security="+newsletterglue_params.ajaxnonce+"&block_id="+r+"&key="+encodeURIComponent(s)+"&thepost="+encodeURIComponent(c);return t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:o,beforeSend:function(){a.addClass("ngl-in-progress").html(newsletterglue_params.refreshing_html),d.addClass("ngl-in-progress")},success:function(t){if(d.removeClass("ngl-in-progress"),t){i.replaceWith(t.item),t.title&&d.find(".ngl-article-title span").html(t.title),t.featured_image&&d.find(".ngl-article-featured img").attr("src",t.featured_image),t.excerpt&&d.find(".ngl-article-excerpt").html(t.excerpt);var e=l.find(".ngl-article-list-item[data-key="+s+"] .ngl-article-list-refresh");e.addClass("ngl-refreshed").html(newsletterglue_params.refreshed_html),setTimeout(function(){e.removeClass("ngl-refreshed").html(n)},2e3)}}}),!1}),t(document).on("click",".ngl-article-list-red",function(e){e.preventDefault();var a=t(this).parents(".ngl-article-list-wrap"),n=t(this).parents(".ngl-article-list-item"),l=t(this).parents(".ngl-articles").attr("data-block-id"),i=n.attr("data-key"),r="action=newsletterglue_ajax_remove_article&security="+newsletterglue_params.ajaxnonce+"&block_id="+l+"&key="+encodeURIComponent(i);return t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:r,beforeSend:function(){n.remove(),t(".ngl-article[data-key="+i+"]").remove(),0==a.find(".ngl-article-list-item").length?a.append('<div class="ngl-article-list-empty">'+newsletterglue_params.no_posts_found+"</div>"):a.find(".ngl-article-list-empty").remove()},success:function(t){}}),!1}),t(document).on("click",".ngl-article-list-move-down a",function(e){e.preventDefault();var n=t(this).parents(".ngl-articles"),l=t(this).parents(".ngl-article-list-item"),i=l.attr("data-key"),r=n.find(".ngl-article[data-key="+i+"]"),s=l.next(),c=r.next(".ngl-article");return 0!==s.length&&(l.insertAfter(s),r.insertAfter(c),a(n)),!1}),t(document).on("click",".ngl-article-list-move-up a",function(e){e.preventDefault();var n=t(this).parents(".ngl-articles"),l=t(this).parents(".ngl-article-list-item"),i=l.attr("data-key"),r=n.find(".ngl-article[data-key="+i+"]"),s=l.prev(),c=r.prev(".ngl-article");return 0!==s.length&&(l.insertBefore(s),r.insertBefore(c),a(n)),!1}),t(document).on("click",".ngl-article-list-url-edit",function(){t(this).select()}),t(document).on("focus",".ngl-article-list-url-edit[contenteditable]",function(){const e=t(this);e.data("before",e.html())}).on("blur keyup paste input",".ngl-article-list-url-edit[contenteditable]",function(){const e=t(this);e.data("before")!==e.html()&&(e.data("before",e.html()),e.trigger("change"))}),t(document).on("change",".ngl-article-list-url-edit[contenteditable]",function(){t(this).parents(".ngl-article-list-item").find(".ngl-article-save-state span").css({display:"none"}),t(this).parents(".ngl-article-list-item").find(".ngl-article-save").css({display:"inline-flex"})}),t(document).on("click",".ngl-article-save",function(){var e=t(this),a=t(this).parents(".ngl-article-list-url"),n=t(this).parents(".ngl-article-list-url").find("div").html(),l=(t(this).parents(".ngl-article-list-wrap"),t(this).parents(".ngl-article-list-item")),i=t(this).parents(".ngl-articles").attr("data-block-id"),r=l.attr("data-key"),s=t(this).parents(".ngl-articles").find(".ngl-article[data-key="+r+"]"),c=t(this).parents(".ngl-articles").attr("data-date_format"),d="action=newsletterglue_ajax_update_url&security="+newsletterglue_params.ajaxnonce+"&block_id="+i+"&key="+encodeURIComponent(r)+"&url="+encodeURIComponent(n)+"&date_format="+encodeURIComponent(c);t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:d,beforeSend:function(){e.css({display:"none"}),a.find(".ngl-article-saving").css({display:"inline-flex"}),s.addClass("ngl-in-progress")},success:function(t){s.removeClass("ngl-in-progress"),t.success?(a.find(".ngl-article-save-state span").css({display:"none"}),a.find(".ngl-article-saved").css({display:"inline-flex"}),s.find(".ngl-article-title span").html(t.data.title),s.find(".ngl-article-featured img").attr("src",t.data.featured_image),s.find(".ngl-article-excerpt").html(t.data.excerpt),s.find(".ngl-article-labels").html(t.data.labels),s.find(".ngl-article-date").html(t.data.date),s.attr("data-post-id",t.data.post_id),s.attr("data-key",t.data.key),s.find(".ngl-article-title a").attr("href",t.data.permalink),s.find(".ngl-article-featured a").attr("href",t.data.permalink),s.find(".ngl-article-featured img").attr("data-original-src",t.data.featured_image),l.replaceWith(t.data.item)):(a.find(".ngl-article-save-state span").css({display:"none"}),a.find(".ngl-article-unsaved").css({display:"inline-flex"}))},error:function(){a.find(".ngl-article-save-state span").css({display:"none"}),a.find(".ngl-article-unsaved").css({display:"inline-flex"})}})})}(jQuery);