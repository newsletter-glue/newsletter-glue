!function(t){"use strict";function e(e){e.find(".ngl-article-list-item").each(function(){var a=e.find(".ngl-article-list-item"),n=a.length-a.index(t(this));t(this).attr("data-key",n)}),e.find(".ngl-articles-wrap .ngl-article:visible").each(function(){var a=e.find(".ngl-article:visible"),n=a.length-a.index(t(this));t(this).attr("data-key",n)});var a=e.attr("data-block-id"),n=[],l=[];e.find(".ngl-article-list-item").each(function(){var e=t(this).attr("data-key"),a=t(this).attr("data-post-id");n.push(e),l.push(a)});var r="action=newsletterglue_ajax_order_articles&security="+newsletterglue_params.ajaxnonce+"&block_id="+a+"&keys="+n+"&values="+l;t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:r})}function a(e){var a=e.parents(".ngl-embed").find(".ngl-embed-content"),n=e.parents(".ngl-embed").attr("data-block-id"),l=e.val(),r="action=newsletterglue_ajax_get_embed&security="+newsletterglue_params.ajaxnonce+"&block_id="+n+"&url="+encodeURIComponent(l);t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:r,beforeSend:function(){a.empty()},success:function(t){t.error&&a.html('<div class="ngl-embed-error">'+t.error+"</div>"),t.html&&a.html(t.html)}})}if(t(document).on("change","#ngl_embed_url",function(e){a(t(this))}),t(document).on("keyup","#ngl_embed_url",function(e){"Enter"!==e.key&&13!==e.keyCode||a(t(this))}),t(".ngl-embed-url").length)setInterval(function(){t(".ngl-embed-url").each(function(){var e=t(this),a=t(this).parents(".ngl-embed").find(".ngl-embed-content"),n=t(this).parents(".ngl-embed").find(".ngl-embed-error");""==e.val()||n.length||t.trim(a.html()).length||e.trigger("change")})},500);t(document).on("submit",".ngl-article-add",function(e){return e.preventDefault(),function(e){var a=e.attr("data-block-id"),n=e.attr("data-date_format"),l=e.find(".ngl_article_s").attr("data-post"),r=e.find(".ngl-article-placeholder");l||(l=e.find(".ngl_article_s").val());var i=e.find(".ngl-article-list-wrap");if(i.find(".ngl-article-list-item").length)var s=parseInt(i.find(".ngl-article-list-item").first().attr("data-key"))+1;else s=1;var c="action=newsletterglue_ajax_add_article&security="+newsletterglue_params.ajaxnonce+"&block_id="+a+"&key="+s+"&thepost="+encodeURIComponent(l)+"&date_format="+encodeURIComponent(n);t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:c,beforeSend:function(){e.find(".ngl-articles-add .ngl-article-status").removeClass("ngl-article-error ngl-article-success").empty()},success:function(t){if(t.error&&(e.find(".ngl-articles-add .ngl-article-status").addClass("ngl-article-error").html(t.error),e.find(".ngl_article_s").focus()),t.key){e.find(".ngl-articles-add .ngl-article-status").addClass("ngl-article-success").html(t.success),e.find(".ngl_article_s").val("").attr("data-post","");var a=r.clone();a.html(a.html().replace("{excerpt}",t.excerpt)),a.html(a.html().replace("{labels}",t.labels)),a.html(a.html().replace("{title}",t.title)),a.html(a.html().replace("{permalink}",t.permalink)),a.html(a.html().replace("{date}",t.date)),a.html(a.html().replace("{featured_image}",t.featured_image)),a.attr("data-post-id",t.post_id),a.attr("data-key",t.key),a.find(".ngl-article-featured a").attr("href",t.permalink),a.prependTo(e.find(".ngl-articles-wrap")).removeClass("ngl-article-placeholder"),e.find(".ngl-article-list-empty").length&&e.find(".ngl-article-list-empty").hide(),e.find(".ngl-article-list-wrap").prepend(t.item),e.find(".ngl-article-list-empty").remove()}}})}(t(this).parents(".ngl-articles")),!1}),t(document).on("focus",".ngl-article-labels[contenteditable]",function(){const e=t(this);e.data("before",e.html()),e.html()==newsletterglue_params.write_labels&&e.html("")}).on("blur keyup paste input",".ngl-article-labels[contenteditable]",function(){const e=t(this);e.data("before")!==e.html()&&(e.data("before",e.html()),e.trigger("change"))}).on("blur",".ngl-article-labels[contenteditable]",function(){const e=t(this);""==e.html()&&e.html(newsletterglue_params.write_labels)}),t(document).on("change",".ngl-article-labels[contenteditable]",function(){var e=t(this).parents(".ngl-article").attr("data-post-id"),a=t(this).html(),n="action=newsletterglue_ajax_update_labels&security="+newsletterglue_params.ajaxnonce+"&post_id="+e+"&labels="+encodeURIComponent(a);t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:n})}),t(document).on("focus",".ngl-article-excerpt[contenteditable]",function(){const e=t(this);e.data("before",e.html())}).on("blur keyup paste input",".ngl-article-excerpt[contenteditable]",function(){const e=t(this);e.data("before")!==e.html()&&(e.data("before",e.html()),e.trigger("change"))}),t(document).on("change",".ngl-article-excerpt[contenteditable]",function(){var e=t(this).parents(".ngl-article").attr("data-post-id"),a=t(this).html(),n="action=newsletterglue_ajax_update_excerpt&security="+newsletterglue_params.ajaxnonce+"&post_id="+e+"&excerpt="+encodeURIComponent(a);t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:n})}),t(document).on("click",".ngl-article-title a",function(t){return t.preventDefault(),!1}),t(document).on("focus",".ngl-article-title span[contenteditable]",function(){const e=t(this);e.data("before",e.html())}).on("blur keyup paste input",".ngl-article-title span[contenteditable]",function(){const e=t(this);e.data("before")!==e.html()&&(e.data("before",e.html()),e.trigger("change"))}),t(document).on("change",".ngl-article-title span[contenteditable]",function(){var e=t(this).parents(".ngl-articles"),a=t(this).parents(".ngl-article").attr("data-post-id"),n=t(this).parents(".ngl-article").attr("data-key"),l=t(this).html(),r="action=newsletterglue_ajax_update_title&security="+newsletterglue_params.ajaxnonce+"&post_id="+a+"&title="+encodeURIComponent(l);e.find(".ngl-article-list-item[data-key="+n+"] .ngl-article-list-title").html(l),t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:r})});var n="";t(document).on("blur input keyup change",".ngl_article_s",function(){var e=t(this).val(),a=t(this).parents(".ngl-article-add").find(".ngl-article-suggest"),l="action=newsletterglue_ajax_search_articles&security="+newsletterglue_params.ajaxnonce+"&term="+encodeURIComponent(e);return function(t){let e;try{e=new URL(t)}catch(t){return!1}return"http:"===e.protocol||"https:"===e.protocol}(e)?(a.hide().empty(),n=null,!1):e.length<3?(a.hide().empty(),n=null,!1):n!=e&&(n=e,void t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:l,success:function(t){t.html?a.show().html(t.html):a.hide().empty()}}))}),t(document).on("click",".ngl-article-suggest li a",function(e){e.preventDefault();var a=t(this).parents(".ngl-article-add"),n=t(this).attr("data-post-id");return a.find(".ngl_article_s").val(t(this).html()).attr("data-post",n),a.find(".ngl-article-suggest").empty().hide(),a.trigger("submit"),!1}),t(document).on("click",".ngl-article-list-head",function(e){e.preventDefault();var a=t(this).parent().find(".ngl-article-list-wrap");return a.is(":visible")?(t(this).find("span").html("expand_less"),a.hide()):(t(this).find("span").html("expand_more"),a.show()),!1}),t(document).on("click",".ngl-article-list-refresh",function(e){e.preventDefault();var a=t(this),n=(t(this).parents(".ngl-article-list-wrap"),t(this).parents(".ngl-article-list-item")),l=t(this).parents(".ngl-articles").attr("data-block-id"),r=n.attr("data-key"),i=n.attr("data-post-id"),s=t(this).parents(".ngl-articles").find(".ngl-article[data-key="+r+"]"),c="action=newsletterglue_ajax_clear_cache&security="+newsletterglue_params.ajaxnonce+"&block_id="+l+"&key="+encodeURIComponent(r)+"&thepost="+encodeURIComponent(i);return t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:c,beforeSend:function(){a.addClass("ngl-in-progress"),s.addClass("ngl-in-progress")},success:function(t){a.removeClass("ngl-in-progress"),s.removeClass("ngl-in-progress"),t&&(n.replaceWith(t.item),t.title&&s.find(".ngl-article-title span").html(t.title),t.featured_image&&s.find(".ngl-article-featured img").attr("src",t.featured_image),t.excerpt&&s.find(".ngl-article-excerpt").html(t.excerpt))}}),!1}),t(document).on("click",".ngl-article-list-red",function(e){e.preventDefault();var a=t(this).parents(".ngl-article-list-wrap"),n=t(this).parents(".ngl-article-list-item"),l=t(this).parents(".ngl-articles").attr("data-block-id"),r=n.attr("data-key"),i="action=newsletterglue_ajax_remove_article&security="+newsletterglue_params.ajaxnonce+"&block_id="+l+"&key="+encodeURIComponent(r);return t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:i,beforeSend:function(){n.remove(),t(".ngl-article[data-key="+r+"]").remove(),0==a.find(".ngl-article-list-item").length?a.append('<div class="ngl-article-list-empty">'+newsletterglue_params.no_posts_found+"</div>"):a.find(".ngl-article-list-empty").remove()},success:function(t){}}),!1}),t(document).on("click",".ngl-article-list-move-down a",function(a){a.preventDefault();var n=t(this).parents(".ngl-articles"),l=t(this).parents(".ngl-article-list-item"),r=l.attr("data-key"),i=n.find(".ngl-article[data-key="+r+"]"),s=l.next(),c=i.next(".ngl-article");return 0!==s.length&&(l.insertAfter(s),i.insertAfter(c),e(n)),!1}),t(document).on("click",".ngl-article-list-move-up a",function(a){a.preventDefault();var n=t(this).parents(".ngl-articles"),l=t(this).parents(".ngl-article-list-item"),r=l.attr("data-key"),i=n.find(".ngl-article[data-key="+r+"]"),s=l.prev(),c=i.prev(".ngl-article");return 0!==s.length&&(l.insertBefore(s),i.insertBefore(c),e(n)),!1})}(jQuery);