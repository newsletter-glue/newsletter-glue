jQuery.fn.selectText=function(){var t=document,e=this[0];if(t.body.createTextRange)(a=document.body.createTextRange()).moveToElementText(e),a.select();else if(window.getSelection){var a,n=window.getSelection();(a=document.createRange()).selectNodeContents(e),n.removeAllRanges(),n.addRange(a)}},function(t){"use strict";function e(e,a,n){e.find(".ngl-article-featured img").prop("src");var l={action:"newsletterglue_save_article_image",key:a,ids:n,security:newsletterglue_params.ajaxnonce};t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:l,success:function(t){t?(e.find(".ngl-article-featured img").prop("src",t.data.url),e.attr("data-attachment",t.data.id),e.find(".ngl-article-featured-edit i.trash").show()):(e.find(".ngl-article-featured img").prop("src",e.find(".ngl-article-featured img").attr("data-original-src")),e.attr("data-attachment",""),e.find(".ngl-article-featured-edit i.trash").hide())}})}function a(e,a=0){e.find(".ngl-articles-wrap .ngl-article:visible").each(function(){var a=e.find(".ngl-article:visible"),n=a.length-a.index(t(this));t(this).attr("data-key",n)});var n=e.attr("data-block-id"),l=[],r=[];e.find(".ngl-article").each(function(){var e=t(this).attr("data-key"),a=t(this).attr("data-post-id");l.push(e),r.push(a)});var i="action=newsletterglue_ajax_order_articles&security="+newsletterglue_params.ajaxnonce+"&block_id="+n+"&keys="+l+"&values="+r+"&is_dup="+a;t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:i})}function n(e){var a=e.parents(".ngl-embed").find(".ngl-embed-content"),n=e.parents(".ngl-embed").attr("data-block-id"),l=e.val(),r="action=newsletterglue_ajax_get_embed&security="+newsletterglue_params.ajaxnonce+"&block_id="+n+"&url="+encodeURIComponent(l);t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:r,beforeSend:function(){a.empty()},success:function(t){t.error&&a.html('<div class="ngl-embed-error">'+t.error+"</div>"),t.html&&a.html(t.html)}})}if(t(document).on("click",".ngl-article-featured a",function(t){return t.preventDefault(),!1}),t(document).on("mouseenter",".ngl-article-featured",function(){var e=t(this).find(".ngl-article-featured-edit"),a=t(this).find("img");a.attr("src")==a.attr("data-original-src")?e.find("i.trash").hide():e.find("i.trash").show()}),t(document).on("click",".ngl-article-featured-edit i.image.outline.icon",function(a){var n,l;return a.preventDefault(),n=t(this).parents(".ngl-article"),l&&l.open(),(l=wp.media({title:newsletterglue_params.select_image,multiple:!1,library:{type:"image"}})).on("close",function(){var t=l.state().get("selection"),a=new Array,r=0;t.each(function(t){a[r]=t.id,r++});var i=a.join(",");n.attr("data-attachment",i),e(n,n.attr("data-post-id"),i)}),l.on("open",function(){var t=l.state().get("selection"),e=n.attr("data-attachment")?n.attr("data-attachment").split(","):"";e&&e.forEach(function(e){if(e){var a=wp.media.attachment(e);a.fetch(),t.add(a?[a]:[])}})}),l.open(),!1}),t(document).on("click",".ngl-article-featured-edit i.trash.outline.icon",function(a){return a.preventDefault(),e(t(this).parents(".ngl-article"),t(this).parents(".ngl-article").attr("data-post-id"),""),!1}),t(document).on("change","#ngl_embed_url",function(e){n(t(this))}),t(document).on("keyup","#ngl_embed_url",function(e){"Enter"!==e.key&&13!==e.keyCode||n(t(this))}),t(".ngl-embed-url").length)setInterval(function(){t(".ngl-embed-url").each(function(){var e=t(this),a=t(this).parents(".ngl-embed").find(".ngl-embed-content"),n=t(this).parents(".ngl-embed").find(".ngl-embed-error");""==e.val()||n.length||t.trim(a.html()).length||e.trigger("change")})},500);t(document).on("click",".ngl-article-add button",function(e){return e.preventDefault(),function(e){var a=e.attr("data-block-id"),n=e.attr("data-date_format"),l=e.find(".ngl_article_s").attr("data-post"),r=e.find(".ngl-article-placeholder");l||(l=e.find(".ngl_article_s").val());var i=e.find(".ngl-articles-wrap");if(i.find(".ngl-article").length)var s=parseInt(i.find(".ngl-article").first().attr("data-key"))+1;else s=1;var c="action=newsletterglue_ajax_add_article&security="+newsletterglue_params.ajaxnonce+"&block_id="+a+"&key="+s+"&thepost="+encodeURIComponent(l)+"&date_format="+encodeURIComponent(n);t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:c,beforeSend:function(){e.find(".ngl-articles-add .ngl-article-status").removeClass("ngl-article-error ngl-article-success").empty()},success:function(t){if(t.error&&(e.find(".ngl-articles-add .ngl-article-status").addClass("ngl-article-error").html(t.error),e.find(".ngl_article_s").focus()),t.key){e.find(".ngl-articles-add .ngl-article-status").addClass("ngl-article-success").html(t.success),e.find(".ngl_article_s").val("").attr("data-post","");var a=r.clone();a.html(a.html().replace("{excerpt}",t.excerpt)),a.html(a.html().replace("{labels}",t.labels)),a.html(a.html().replace("{title}",t.title)),a.html(a.html().replace("{permalink}",t.permalink)),a.html(a.html().replace("{date}",t.date)),a.html(a.html().replace("{featured_image}",t.featured_image)),a.attr("data-post-id",t.post_id),a.attr("data-key",t.key),a.find(".ngl-article-featured a").attr("href",t.permalink),a.find(".ngl-article-featured img").attr("data-original-src",t.featured_image),a.prependTo(e.find(".ngl-articles-wrap")).removeClass("ngl-article-placeholder"),e.find(".ngl-article-list-empty").length&&e.find(".ngl-article-list-empty").hide(),e.find(".ngl-article-list-wrap").prepend(t.item),e.find(".ngl-article-list-empty").remove()}}})}(t(this).parents(".ngl-articles")),!1}),t(document).on("focus",".ngl-article-labels[contenteditable]",function(){const e=t(this);e.data("before",e.html()),e.html()==newsletterglue_params.write_labels&&e.html("")}).on("blur keyup paste input",".ngl-article-labels[contenteditable]",function(){const e=t(this);e.data("before")!==e.html()&&(e.data("before",e.html()),e.trigger("change"))}).on("blur",".ngl-article-labels[contenteditable]",function(){const e=t(this);""==e.html()&&e.html(newsletterglue_params.write_labels)}),t(document).on("change",".ngl-article-labels[contenteditable]",function(){var e=t(this).parents(".ngl-article").attr("data-post-id"),a=t(this).html(),n="action=newsletterglue_ajax_update_labels&security="+newsletterglue_params.ajaxnonce+"&post_id="+e+"&labels="+encodeURIComponent(a);t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:n})}),t(document).on("focus",".ngl-article-excerpt[contenteditable]",function(){const e=t(this);e.data("before",e.html())}).on("blur keyup paste input",".ngl-article-excerpt[contenteditable]",function(){const e=t(this);e.data("before")!==e.html()&&(e.data("before",e.html()),e.trigger("change"))}),t(document).on("change",".ngl-article-excerpt[contenteditable]",function(){var e=t(this).parents(".ngl-article").attr("data-post-id"),a=t(this).html(),n="action=newsletterglue_ajax_update_excerpt&security="+newsletterglue_params.ajaxnonce+"&post_id="+e+"&excerpt="+encodeURIComponent(a);t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:n})}),t(document).on("click",".ngl-article-title a",function(t){return t.preventDefault(),!1}),t(document).on("focus",".ngl-article-title span[contenteditable]",function(){const e=t(this);e.data("before",e.html())}).on("blur keyup paste input",".ngl-article-title span[contenteditable]",function(){const e=t(this);e.data("before")!==e.html()&&(e.data("before",e.html()),e.trigger("change"))}),t(document).on("change",".ngl-article-title span[contenteditable]",function(){var e=t(this).parents(".ngl-articles"),a=t(this).parents(".ngl-article").attr("data-post-id"),n=t(this).parents(".ngl-article").attr("data-key"),l=t(this).html(),r="action=newsletterglue_ajax_update_title&security="+newsletterglue_params.ajaxnonce+"&post_id="+a+"&title="+encodeURIComponent(l);e.find(".ngl-article-list-item[data-key="+n+"] .ngl-article-list-title").html(l),t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:r})});var l="";t(document).on("blur input keyup change",".ngl_article_s",function(){var e=t(this).val(),a=t(this).parents(".ngl-article-add").find(".ngl-article-suggest"),n="action=newsletterglue_ajax_search_articles&security="+newsletterglue_params.ajaxnonce+"&term="+encodeURIComponent(e);return function(t){let e;try{e=new URL(t)}catch(t){return!1}return"http:"===e.protocol||"https:"===e.protocol}(e)?(a.hide().empty(),l=null,!1):e.length<3?(a.hide().empty(),l=null,!1):l!=e&&(l=e,void t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:n,success:function(t){t.html?a.show().html(t.html):a.hide().empty()}}))}),t(document).on("click",".ngl-article-suggest li a",function(e){e.preventDefault();var a=t(this).parents(".ngl-article-add"),n=t(this).attr("data-post-id");return a.find(".ngl_article_s").val(t(this).html()).attr("data-post",n),a.find(".ngl-article-suggest").empty().hide(),a.find("button").trigger("click"),!1}),t(document).on("click",".ngl-article-list-head",function(e){e.preventDefault();var a=t(this).parent().find(".ngl-article-list-wrap");return a.is(":visible")?(t(this).find("span").html("expand_less"),a.hide()):(t(this).find("span").html("expand_more"),a.show()),!1}),t(document).on("click",".ngl-article-list-refresh",function(e){e.preventDefault();var a=t(this),n=(t(this).html(),t(this).parents(".ngl-articles"),t(this).parents(".ngl-article")),l=t(this).parents(".ngl-articles").attr("data-block-id"),r=n.attr("data-key"),i=n.attr("data-post-id"),s="action=newsletterglue_ajax_clear_cache&security="+newsletterglue_params.ajaxnonce+"&block_id="+l+"&key="+encodeURIComponent(r)+"&thepost="+encodeURIComponent(i);return t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:s,beforeSend:function(){a.addClass("ngl-in-progress ngl-is-toggled"),n.find(".ngl-article-list-link").removeClass("ngl-is-toggled"),n.find(".ngl-article-list-url-edit").removeClass("ngl-show-state"),n.find(".ngl-article-state-refreshing").addClass("ngl-show-state"),n.find(".ngl-article-overlay").show()},success:function(t){a.removeClass("ngl-in-progress").addClass("ngl-in-done"),a.find("i").removeClass().addClass("check icon"),n.find(".ngl-article-state-refreshing").html(newsletterglue_params.refreshed_html).addClass("ngl-refreshed"),setTimeout(function(){n.find(".ngl-article-overlay").hide(),n.find(".ngl-article-state-refreshing").html(newsletterglue_params.refreshing_html).removeClass("ngl-show-state ngl-refreshed"),a.removeClass("ngl-in-done ngl-is-toggled"),a.find("i").removeClass().addClass("sync icon")},1e3),t&&(t.title&&n.find(".ngl-article-title span").html(t.title),t.featured_image&&n.find(".ngl-article-featured img").attr("src",t.featured_image),t.excerpt&&n.find(".ngl-article-excerpt").html(t.excerpt))}}),!1}),t(document).on("click",".ngl-article-overlay",function(e){var a=t(this).parents(".ngl-article"),n=t(this).parents(".ngl-article").find(".ngl-article-state-remove"),l=t(this).parents(".ngl-article").find(".ngl-article-list-url-edit");n.hasClass("ngl-show-state")?a.find(".ngl-article-list-delete").trigger("click"):l.hasClass("ngl-show-state")&&a.find(".ngl-article-list-link").trigger("click")}),t(document).on("click",".ngl-article-state-remove",function(e){if(e.preventDefault(),!t(this).hasClass("ngl-show-state"))return!1;var a=t(this).parents(".ngl-article"),n=t(this).parents(".ngl-articles").attr("data-block-id"),l=a.attr("data-key"),r="action=newsletterglue_ajax_remove_article&security="+newsletterglue_params.ajaxnonce+"&block_id="+n+"&key="+encodeURIComponent(l);return t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:r,beforeSend:function(){a.remove()},success:function(t){}}),!1}),t(document).on("click",".ngl-article-list-move-down a",function(e){e.preventDefault();var n=t(this).parents(".ngl-articles"),l=t(this).parents(".ngl-article"),r=(l.attr("data-key"),l.next());return 0!==r.length&&(l.insertAfter(r),a(n)),!1}),t(document).on("click",".ngl-article-list-move-up a",function(e){e.preventDefault();var n=t(this).parents(".ngl-articles"),l=t(this).parents(".ngl-article"),r=(l.attr("data-key"),l.prev());return 0!==r.length&&(l.insertBefore(r),a(n)),!1}),t(document).on("focus",".ngl-article-list-url-edit span[contenteditable]",function(){const e=t(this);e.data("before",e.html())}).on("blur keyup paste input",".ngl-article-list-url-edit span[contenteditable]",function(){const e=t(this);e.data("before")!==e.html()&&(e.data("before",e.html()),e.trigger("change"))}),t(document).on("click",".ngl-article-list-url-edit a",function(e){e.preventDefault();t(this);var a=t(this).parent().find("span").html(),n=t(this).parents(".ngl-article"),l=t(this).parents(".ngl-articles").attr("data-block-id"),r=n.attr("data-key"),i=t(this).parents(".ngl-articles").attr("data-date_format"),s="action=newsletterglue_ajax_update_url&security="+newsletterglue_params.ajaxnonce+"&block_id="+l+"&key="+encodeURIComponent(r)+"&url="+encodeURIComponent(a)+"&date_format="+encodeURIComponent(i);return t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:s,beforeSend:function(){},success:function(t){n.find(".ngl-article-overlay").hide(),n.find(".ngl-article-list-url-edit").removeClass("ngl-show-state"),n.find(".ngl-article-list-link").removeClass("ngl-is-toggled"),t.success&&(n.find(".ngl-article-title span").html(t.data.title),n.find(".ngl-article-featured img").attr("src",t.data.featured_image),n.find(".ngl-article-excerpt").html(t.data.excerpt),n.find(".ngl-article-labels").html(t.data.labels),n.find(".ngl-article-date").html(t.data.date),n.attr("data-post-id",t.data.post_id),n.attr("data-key",t.data.key),n.find(".ngl-article-title a").attr("href",t.data.permalink),n.find(".ngl-article-featured a").attr("href",t.data.permalink),n.find(".ngl-article-featured img").attr("data-original-src",t.data.featured_image))},error:function(){}}),!1}),t(document).on("change",".ngl-article-list-url-edit span[contenteditable]",function(){t(this).parent().find("a").show()}),t(document).on("mouseleave",".ngl-article",function(e){t(this).find(".ngl-article-state-remove").hasClass("ngl-show-state")}),t(document).on("click",".ngl-article-list-link",function(e){e.preventDefault();var a=t(this).parents(".ngl-article"),n=a.find(".ngl-article-list-url-edit");return n.hasClass("ngl-show-state")?(a.find(".ngl-article-overlay").hide(),n.removeClass("ngl-show-state"),t(this).removeClass("ngl-is-toggled")):(a.find(".ngl-article-overlay").show(),n.addClass("ngl-show-state"),n.find("span").selectText(),t(this).addClass("ngl-is-toggled")),!1}),t(document).on("click",".ngl-article-list-delete",function(e){e.preventDefault();var a=t(this).parents(".ngl-article"),n=a.find(".ngl-article-state-remove");return n.hasClass("ngl-show-state")?(a.find(".ngl-article-overlay").hide(),n.removeClass("ngl-show-state"),a.find(".ngl-article-list-move, .ngl-article-list-refresh, .ngl-article-list-link").show(),t(this).removeClass("ngl-is-toggled")):(a.find(".ngl-article-overlay").show(),n.addClass("ngl-show-state"),a.find(".ngl-article-list-move, .ngl-article-list-refresh, .ngl-article-list-link").hide(),t(this).addClass("ngl-is-toggled")),!1});setInterval(function(){var e=t(".ngl_article_s");if(0==e.length)return!1;e.each(function(){var e=t(this).parents('div[data-type="newsletterglue/article"]').attr("data-block"),n=t(this).parents(".ngl-articles").attr("data-block-id"),l=t(this).parents(".ngl-articles"),r=wp.data.select("core/block-editor").getBlock(e);if("pattern"==(r&&r.attributes.scope?r.attributes.scope:"regular")&&typenow&&"ngl_pattern"!=typenow){var i=e.replace(/-/g,"");r.attributes.block_id=i,r.attributes.scope="regular",l.attr("data-block-id",i),wp.data.dispatch("core/block-editor").updateBlock(r.clientId,r.attributes),a(l,n),l.parents('div[data-type="newsletterglue/article"]').find(".ngl-ajax-block-id").html("ID: "+i),l.parents('div[data-type="newsletterglue/article"]').find(".ngl-ajax-block-scope").html("regular")}var s=t(this).parents(".ngl-articles").attr("data-block-id");if(t('.ngl-articles[data-block-id="'+s+'"]').length>1){var c=t('.ngl-articles[data-block-id="'+s+'"]:first'),o=t('.ngl-articles[data-block-id="'+s+'"]:last'),d=o.parents('div[data-type="newsletterglue/article"]').attr("data-block"),g=wp.data.select("core/block-editor").getBlock(d),u=d.replace(/-/g,"");g.attributes.block_id=u,o.attr("data-block-id",u),wp.data.dispatch("core/block-editor").updateBlock(g.clientId,g.attributes),a(o,c.attr("data-block-id")),o.parents('div[data-type="newsletterglue/article"]').find(".ngl-ajax-block-id").html("ID: "+u)}})},100);setInterval(function(){t(".block-editor-writing-flow [data-block].has-warning").length&&t(".block-editor-writing-flow [data-block].has-warning").each(function(){t(this).find("button.components-button.is-primary").trigger("click")}),t(".ngl-metadata").length&&t(".ngl-metadata").each(function(){var e=t(this).children().last();e.hasClass("ngl-metadata-sep")&&e.hide()})},100)}(jQuery);