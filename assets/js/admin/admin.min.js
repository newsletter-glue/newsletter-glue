!function(e){"use strict";var n,t,l;function a(){var n=e(".ngl-popup-panel").find(".ngl-popup-settings").attr("data-block"),t=e(".ngl-popup-panel").find(".ngl-popup-demo").attr("data-block");e(".ngl-popup-overlay").removeClass("ngl-active"),e("body").removeClass("ngl-popup-hidden"),e(".ngl-popup-panel .ngl-popup-settings").appendTo(e(".ngl-block[data-block="+n+"]")),e(".ngl-popup-panel .ngl-popup-demo").appendTo(e(".ngl-block[data-block="+t+"]"))}function s(){e(".ngl-card-state.is-testing").removeClass("ngl-hidden"),e(".ngl-card-state.is-invalid").addClass("ngl-hidden")}function i(){e(".ngl-card-state.is-testing").addClass("ngl-hidden"),e(".ngl-card-state.is-invalid").removeClass("ngl-hidden")}function o(){var t,l;e(".ngl-card-state.is-testing").addClass("ngl-hidden"),e(".ngl-card-state.is-working").removeClass("ngl-hidden"),e(".ngl-card-view").length?setTimeout(function(){e(".ngl-card-state, .ngl-card-add2").addClass("ngl-hidden"),e(".ngl-card-view-"+n).length?e(".ngl-card-view-"+n).removeClass("ngl-hidden"):e(".ngl-card-view").removeClass("ngl-hidden")},2e3):(e(".ngl-boarding:visible").addClass("is-hidden"),e(".ngl-boarding[data-screen=3]").removeClass("is-hidden"),t=n,l="action=newsletterglue_ajax_get_onboarding_settings&security="+newsletterglue_params.ajaxnonce+"&api="+t,e.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:l,success:function(n){n&&(e(".ngl-modal:visible").prepend(n),e(".ngl-boarding-next").removeClass("disabled").addClass("ready"))}}))}function r(){e(".ngl-modal-overlay").addClass("off")}function d(){var n=e(".ngl-metabox");if(0==n.length)return!1;if(e(".ngl-settings").length)return!1;var t=!0;n.find("input[type=text].is-required").each(function(){""==e(this).val()||e(this).attr("data-force-unready")?(t=!1,e(this).closest(".ngl-metabox-flex").addClass("is-error")):e(this).closest(".ngl-metabox-flex").removeClass("is-error")}),n.find(".dropdown.is-required").each(function(){""==e(this).dropdown("get value")?(t=!1,e(this).closest(".ngl-metabox-flex").addClass("is-error")):e(this).closest(".ngl-metabox-flex").removeClass("is-error")}),n.find("#ngl_send_newsletter").is(":checked")&&n.find("#ngl_double_optin").is(":checked")?(e("#ngl_send_newsletter2").prop("checked",!0),e("#ngl_double_confirm").val("yes")):(e("#ngl_send_newsletter2").prop("checked",!1),e("#ngl_double_confirm").val("no")),t?(e(".ngl-ready").removeClass("is-hidden"),e(".ngl-not-ready").addClass("is-hidden"),e(".editor-post-publish-button__button.is-primary").removeAttr("disabled"),e(".ngl-newsletter-errors").remove(),e(".ngl-top-checkbox").removeClass("disable-send")):(e(".ngl-ready").addClass("is-hidden"),e(".ngl-not-ready").removeClass("is-hidden"),e(".editor-post-publish-button__button.is-primary").attr("disabled","disabled"),0==e(".ngl-newsletter-errors").length&&e(".edit-post-header__settings").prepend('<span class="ngl-newsletter-errors">'+newsletterglue_params.publish_error+"</span>"),e(".ngl-top-checkbox").addClass("disable-send")),e("#ngl_send_newsletter").is(":checked")||(e(".ngl-newsletter-errors").remove(),e(".editor-post-publish-button__button.is-primary").removeAttr("disabled"),e(".ngl-top-checkbox").removeClass("disable-send"))}e(".ngl .ui.dropdown, .ngl-metabox .ui.dropdown").dropdown({onChange:function(){d()}}),e(".ngl .ui.checkbox").checkbox(),e(".ngl-date").flatpickr({enableTime:!0,dateFormat:"Y-m-d H:i:s",altInput:!0,enableSeconds:!0,altFormat:"H:i:s, Y/m/d",minDate:"today",onChange:function(){d()}}),e(document).on("click",".ngl-card-add",function(n){e(this).addClass("ngl-hidden"),e(".ngl-card-base").removeClass("ngl-hidden")}),e(".ngl-app").dropdown("setting","onChange",function(t){e(this).parents(".ngl-card-base").addClass("ngl-hidden"),e(".ngl-card-"+t).removeClass("ngl-hidden"),n=t}),e(document).on("click",".ngl-back",function(n){if(t)e(this).parent().parent().addClass("ngl-hidden");else{var l=e(this).attr("data-screen");e(".ngl-app").dropdown("clear"),e(this).parent().parent().addClass("ngl-hidden"),e("."+l).removeClass("ngl-hidden")}}),e(document).on("submit",".ngl-license-form",function(n){n.preventDefault();var t=e(this),a=t.serialize()+"&action=newsletterglue_check_license&security="+newsletterglue_params.ajaxnonce,r=!1;return t.find("input[type=text]:visible").each(function(){""==e(this).val()&&(e(this).addClass("error").focus(),r=!0)}),!r&&(l=e.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:a,beforeSend:function(){s()},success:function(e){console.log(e),setTimeout(function(){"invalid"===e.status&&(t.parents(".ngl-cards").find(".ngl-card-state.is-invalid .ngl-card-state-text").html(e.message),i()),"valid"===e.status&&o()},1e3)},error:function(){i()}}),!1)}),e(document).on("submit",".ngl-fields form",function(n){n.preventDefault();var t=e(this),a=e(this).parents(".ngl-card-add2").attr("data-app"),r=t.serialize()+"&action=newsletterglue_ajax_connect_api&security="+newsletterglue_params.ajaxnonce+"&app="+a,d=!1;return e(".ngl-card-"+a).hasClass("ngl-hidden")||t.find("input[type=text]:visible").each(function(){""==e(this).val()&&(e(this).addClass("error").focus(),d=!0)}),!d&&(l=e.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:r,beforeSend:function(){s()},success:function(e){setTimeout(function(){"invalid"===e.response&&i(),"successful"===e.response&&o()},1e3)}}),!1)}),e(document).on("click",".ngl-ajax-stop-test",function(n){return n.preventDefault(),e(this).parents(".ngl-card-state").addClass("ngl-hidden"),l.abort(),!1}),e(document).on("click",".ngl-ajax-test-connection",function(t){return t.preventDefault(),(n=e(this).parents(".ngl-card-view").attr("data-app"))?e(".ngl-card-add2.ngl-card-"+n+" .ngl-fields form").trigger("submit"):e(".ngl-card-add2 .ngl-license-form").trigger("submit"),!1}),e(document).on("click",".ngl-ajax-test-again",function(n){return n.preventDefault(),e(".ngl-card-add2 .ngl-fields form").length&&e(".ngl-card-add2 .ngl-fields form").trigger("submit"),e(".ngl-card-add2 .ngl-license-form").length&&e(".ngl-card-add2 .ngl-license-form").trigger("submit"),!1}),e(document).on("click",".ngl-ajax-test-close",function(n){return n.preventDefault(),e(".ngl-card-state.is-invalid").addClass("ngl-hidden"),!1}),e(document).on("click",".ngl-ajax-edit-connection",function(l){return l.preventDefault(),e(".ngl-card-state.is-invalid").addClass("ngl-hidden"),e(this).parents(".ngl-card-view").is(":visible")&&(n=e(this).parents(".ngl-card-view").attr("data-app"),t=e(this).parents(".ngl-card-view-"+n)),n?e(".ngl-card-add2.ngl-card-"+n).removeClass("ngl-hidden"):e(".ngl-card-add2.ngl-hidden").removeClass("ngl-hidden"),!1}),e(document).on("click",".ngl-ajax-remove-connection",function(t){return t.preventDefault(),n=e(this).parents(".ngl-card-view").attr("data-app"),e(".ngl-ajax-remove").attr("data-ngl_app",n),e(".ngl-card-state.confirm-remove").removeClass("ngl-hidden"),!1}),e(document).on("click",".ngl-ajax-remove",function(n){n.preventDefault(),e(".ngl-card-state.confirm-remove").addClass("ngl-hidden"),e(".ngl-card-state.is-removed").removeClass("ngl-hidden"),e(".ngl-app").dropdown("clear");var t=e(this).attr("data-ngl_app");if(t)var l="newsletterglue_ajax_remove_api";else l="newsletterglue_deactivate_license";if(t)var a="action="+l+"&security="+newsletterglue_params.ajaxnonce+"&app="+t;else a="action="+l+"&security="+newsletterglue_params.ajaxnonce;return e.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:a,success:function(n){setTimeout(function(){e(".ngl-card-add").removeClass("ngl-hidden"),e(".ngl-card-state, .ngl-card-add2, .ngl-card-view").addClass("ngl-hidden"),e(".ngl-card-license-form").length&&e(".ngl-card-license-form").removeClass("ngl-hidden")},2e3)}}),!1}),e(document).on("change","#ngl_double_optin",function(){e(this).is(":checked")?(e(".ngl-top-checkbox").hasClass("is-hidden")&&e(".ngl-top-checkbox").removeClass("is-hidden"),e("#ngl_send_newsletter2").prop("checked",!0),e("#ngl_double_confirm").val("yes")):(e("#ngl_send_newsletter2").prop("checked",!1),e("#ngl_double_confirm").val("no")),d()}),e(document).on("change","#ngl_send_newsletter",function(){e(this).is(":checked")?(e(".ngl-top-checkbox").hasClass("is-hidden")&&e(".ngl-top-checkbox").removeClass("is-hidden"),e(".ngl-metabox-if-checked").removeClass("is-hidden")):e(".ngl-metabox-if-checked").addClass("is-hidden"),d(),e(this).is(":checked")||e("#ngl_send_newsletter2").prop("checked",!1)}),e(document).on("change","#ngl_send_newsletter2",function(){e(this).is(":checked")?(e("#ngl_send_newsletter").prop("checked",!0).trigger("change"),e("#ngl_double_confirm").val("yes")):(e("#ngl_send_newsletter").prop("checked",!1).trigger("change"),e("#ngl_double_confirm").val("no"))}),e(document).on("change","#newsletter_glue_metabox #ngl_from_email",function(){var n,t,l;n=e("#ngl_from_email").val(),t=e("#ngl_app").val(),l="action=newsletterglue_ajax_verify_email&security="+newsletterglue_params.ajaxnonce+"&email="+n+"&app="+t,e.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:l,beforeSend:function(){e(".ngl-process").addClass("is-hidden"),e(".ngl-process.is-waiting").removeClass("is-hidden")},success:function(n){e(".ngl-process").addClass("is-hidden"),n.success||!0===n?(n.success&&(e(".ngl-process.is-valid").removeClass("is-hidden"),e(".ngl-process.is-valid .ngl-process-text").html(n.success)),e("#ngl_from_email").parent().parent().parent().removeClass("is-error"),e("#ngl_from_email").removeAttr("data-force-unready")):(e(".ngl-process.is-invalid").removeClass("is-hidden"),e(".ngl-process.is-invalid .ngl-process-text").html(n.failed),e("#ngl_from_email").parent().parent().parent().addClass("is-error"),e("#ngl_from_email").attr("data-force-unready",!0)),d()}})}),e(".ngl-metabox input[type=text].js-limit").each(function(n,t){var l=e(this).val();e(this).attr("data-value",l),l.length>30?e(this).parent().find(".ngl-limit").show():e(this).parent().find(".ngl-limit").hide()}),e(document).on("focus",".ngl-metabox input[type=text].js-limit",function(n){e(this).parent().find(".ngl-limit").hide()}),e(document).on("click",".ngl-metabox .ngl-limit",function(n){e(this).parents(".ui.input").find(".js-limit").focus()}),e(document).on("blur",".ngl-metabox input[type=text].js-limit",function(n){var t=e(this).val();e(this).attr("data-value",t),t.length>30?e(this).parent().find(".ngl-limit").show():e(this).parent().find(".ngl-limit").hide()}),e(document).on("change",".ngl-metabox input[type=text]",function(){d()}),e(document).on("blur",".editor-post-title__input",function(){e(this).val()&&""==e("#ngl_subject").val()&&e("#ngl_subject").val(e(this).val()).trigger("change")}),e(document).on("click",".ngl-review-link",function(n){e.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:"action=newsletterglue_clicked_review_button&security="+newsletterglue_params.ajaxnonce})}),e(document).on("click",".ngl-reset-newsletter",function(n){n.preventDefault();var t=e(this),l=e(this).attr("data-post_id"),a="action=newsletterglue_ajax_reset_newsletter&security="+newsletterglue_params.ajaxnonce+"&post_id="+l;return e("#ngl_double_optin").prop("checked",!1),e("#ngl_double_confirm").val("no"),e.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:a,beforeSend:function(){t.addClass("loading")},success:function(n){t.removeClass("loading"),e(".ngl-reset, .ngl-msgbox-wrap").addClass("is-hidden"),e(".ngl-send").removeClass("is-hidden"),e("#ngl_send_newsletter").is(":checked")||e("#ngl_send_newsletter").trigger("click")}}),!1}),e(document).on("click",".ngl-test-email",function(n){n.preventDefault();var t=e(this),l=e(this).attr("data-post_id"),a=t.parents(".ngl-metabox"),s="action=newsletterglue_ajax_test_email&security="+newsletterglue_params.ajaxnonce+"&post_id="+l;return a.find("input[type=text], select, input[type=hidden]").each(function(){s=s+"&"+e(this).attr("id")+"="+encodeURIComponent(e(this).val())}),a.find("input[type=checkbox]").each(function(){e(this).is(":checked")&&(s=s+"&"+e(this).attr("id")+"=1")}),e.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:s,beforeSend:function(){e(".ngl-is-default").hide(),e(".ngl-is-sending").show(),e(".ngl-test-result").hide()},success:function(n){e(".ngl-is-sending").hide(),e(".ngl-action-link").show(),n.success?(e(".ngl-is-valid").show(),e(".ngl-test-result.ngl-is-valid").show().html(n.success)):(e(".ngl-is-invalid").show(),e(".ngl-test-result.ngl-is-invalid").show().html(n.fail))}}),!1}),e(document).on("click",".ngl-retest",function(n){return n.preventDefault(),e(".ngl-action-link, .ngl-action button, .ngl-is-valid, .ngl-is-invalid").hide(),e(".ngl-is-default").show(),!1}),e(document).on("click",".ngl-newsletter-errors a",function(n){return n.preventDefault(),e(".ngl-metabox .is-error").find("input:first").focus(),!1}),e(document).on("click",".ngl-modal-log",function(n){return n.preventDefault(),function(n){e(".ngl-modal-overlay").removeClass("off");var t=n.parents("td");e(".ngl-modal-content").html(t.find(".ngl-modal-contents").html())}(e(this)),!1}),e(document).on("click",".ngl-modal-close",function(e){return e.preventDefault(),r(),!1}),e(document).on("click",".ngl-modal-overlay:not(.onboarding)",function(e){return e.preventDefault(),r(),!1}),e(document).on("click",".ngl-modal",function(e){e.stopPropagation()}),e(document).on("click",".editor-post-publish-button",function(n){var t=e(".ngl-send");e(".ngl-reset-newsletter").is(":visible")&&e("#ngl_send_newsletter, #ngl_send_newsletter2, #ngl_double_optin").prop("checked",!1),!e(".ngl-top-checkbox").hasClass("is-hidden")&&e("#ngl_send_newsletter2").is(":checked")&&(t.addClass("is-hidden"),e(".ngl-msgbox-wrap").removeClass("is-hidden"),e(".ngl-top-checkbox").addClass("is-hidden")),e("#ngl_send_newsletter2").is(":checked")||e("#ngl_double_optin").prop("checked",!1)}),e(document).delegate(".ngl-textarea","keydown",function(n){if(9==(n.keyCode||n.which)){n.preventDefault();var t=this.selectionStart,l=this.selectionEnd;e(this).val(e(this).val().substring(0,t)+"\t"+e(this).val().substring(l)),this.selectionStart=this.selectionEnd=t+1}}),e(document).on("click",".ngl-settings-save:not(.saved)",function(n){return n.preventDefault(),e(".ngl-settings input[type=text], .ngl-settings textarea, .ngl-settings input[type=checkbox], .ngl-settings select").trigger("change"),!1}),e(document).on("change",".ngl-settings input[type=text], .ngl-settings textarea, .ngl-settings input[type=checkbox], .ngl-settings select, .ngl-boarding .ngl-metabox-segment select",function(){if(!e("body").find(".ngl-theme").length){var n=e(this).parents(".ngl-ajax-field"),t=e(".ngl-settings-save"),l=e(this).attr("id"),a=e(this).val();e(this).is(":checkbox")&&(a=e(this).is(":checked")?1:0),a=encodeURIComponent(a);var s="action=newsletterglue_ajax_save_field&security="+newsletterglue_params.ajaxnonce+"&id="+l+"&value="+a;e.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:s,beforeSend:function(){n.find(".ngl-process").addClass("is-hidden"),n.find(".ngl-process.is-waiting").removeClass("is-hidden"),t.html(newsletterglue_params.saving),"ngl_from_email"==l&&e(".ngl-boarding").length&&e(".ngl-boarding-next").addClass("disabled")},success:function(a){t.addClass("saved").html(newsletterglue_params.saved),setTimeout(function(){t.removeClass("saved").html(newsletterglue_params.save)},2e3),n.find(".ngl-process").addClass("is-hidden"),a.failed?(n.find(".ngl-process.is-invalid").removeClass("is-hidden"),n.find(".ngl-process.is-invalid .ngl-process-text").html(a.failed),n.parent().parent().addClass("is-error")):a.success?(n.find(".ngl-process.is-valid").removeClass("is-hidden"),n.find(".ngl-process.is-valid .ngl-process-text").html(a.success),n.parent().parent().removeClass("is-error")):(n.parent().parent().removeClass("is-error"),n.find(".ngl-process.is-valid").removeClass("is-hidden"),setTimeout(function(){n.find(".ngl-process").addClass("is-hidden")},1500)),n.parent().parent().hasClass("is-error")||"ngl_from_email"==l&&e(".ngl-boarding").length&&setTimeout(function(){e(".ngl-boarding-next").removeClass("disabled").addClass("ready")},1500)}})}}),e(document).on("click",".ngl-block-useall",function(n){return n.preventDefault(),e(".ngl-block").each(function(){e(this).removeClass("ngl-block-unused").addClass("ngl-block-used"),e(this).find("input[type=checkbox]").prop("checked",!0)}),e.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:"action=newsletterglue_ajax_use_all_blocks&security="+newsletterglue_params.ajaxnonce}),!1}),e(document).on("click",".ngl-block-disableall",function(n){return n.preventDefault(),e(".ngl-block").each(function(){e(this).removeClass("ngl-block-used").addClass("ngl-block-unused"),e(this).find("input[type=checkbox]").prop("checked",!1)}),e.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:"action=newsletterglue_ajax_disable_all_blocks&security="+newsletterglue_params.ajaxnonce}),!1}),e(document).on("change",".ngl-block-use input[type=checkbox]",function(n){var t=e(this).attr("id");if(e(this).is(":checked")){var l="yes";e(this).parents(".ngl-block").removeClass("ngl-block-unused").addClass("ngl-block-used")}else{l="no";e(this).parents(".ngl-block").removeClass("ngl-block-used").addClass("ngl-block-unused")}e.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:"action=newsletterglue_ajax_use_block&security="+newsletterglue_params.ajaxnonce+"&id="+t+"&value="+l})}),e(document).on("click",".ngl-block-demo",function(n){n.preventDefault();var t=e(this).parents(".ngl-block").attr("data-block");return e(".ngl-popup-overlay").addClass("ngl-active"),e("body").addClass("ngl-popup-hidden"),e(".ngl-popup-overlay.ngl-active").find(".ngl-popup-panel").empty(),e(".ngl-popup-demo[data-block="+t+"]").appendTo(e(".ngl-popup-overlay.ngl-active").find(".ngl-popup-panel")),e(".ngl-popup-overlay.ngl-active").addClass("ngl-popup-overlay-demo"),e(".ngl-popup-overlay.ngl-active").removeClass("ngl-popup-overlay-settings"),!1}),e(document).on("click",".ngl-block-defaults a",function(n){n.preventDefault();var t=e(this).parents(".ngl-block").attr("data-block");return e(".ngl-popup-overlay").addClass("ngl-active"),e("body").addClass("ngl-popup-hidden"),e(".ngl-popup-overlay.ngl-active").find(".ngl-popup-panel").empty(),e(".ngl-popup-settings[data-block="+t+"]").appendTo(e(".ngl-popup-overlay.ngl-active").find(".ngl-popup-panel")),e(".ngl-popup-overlay.ngl-active").removeClass("ngl-popup-overlay-demo"),e(".ngl-popup-overlay.ngl-active").addClass("ngl-popup-overlay-settings"),!1}),e(document).on("click",".ngl-popup-panel",function(e){e.stopPropagation()}),e(document).on("click",function(){a()}),e(document).on("click",".ngl-popup-close",function(e){e.preventDefault(),a()}),e(document).on("change",".ngl-popup-settings input[type=checkbox]",function(n){var t=e(this).parents(".ngl-popup-settings").attr("data-block"),l=e(this).parents("form").serialize()+"&action=newsletterglue_ajax_save_block&security="+newsletterglue_params.ajaxnonce+"&id="+t;e.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:l,success:function(e){}})}),e(document).on("change",".ngl-settings-mailchimp #ngl_audience, .ngl-mb-mailchimp #ngl_audience",function(e){}),e(window).on("load",function(){e("#ngl_send_newsletter").length&&e(".edit-post-header__settings").prepend('<div class="ngl-top-checkbox is-hidden"><label><input type="checkbox" name="ngl_send_newsletter2" id="ngl_send_newsletter2" value="1">'+newsletterglue_params.send_newsletter+"</label></div>")})}(jQuery);