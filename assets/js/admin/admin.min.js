!function(l){"use strict";var t,a,i;function n(){var e=l(".ngl-popup-panel").find(".ngl-popup-settings").attr("data-block"),n=l(".ngl-popup-panel").find(".ngl-popup-demo").attr("data-block");l(".ngl-popup-overlay").removeClass("ngl-active"),l("body").removeClass("ngl-popup-hidden"),l(".ngl-popup-panel .ngl-popup-settings").appendTo(l(".ngl-block[data-block="+e+"]")),l(".ngl-popup-panel .ngl-popup-demo").appendTo(l(".ngl-block[data-block="+n+"]"))}function o(){var e,n;l(".ngl-card-state.is-testing").addClass("ngl-hidden"),l(".ngl-card-state.is-working").removeClass("ngl-hidden"),l(".ngl-card-view").length?setTimeout(function(){l(".ngl-card-state, .ngl-card-add2").addClass("ngl-hidden"),l(".ngl-card-view-"+t).removeClass("ngl-hidden")},2e3):(l(".ngl-boarding:visible").addClass("is-hidden"),l(".ngl-boarding[data-screen=3]").removeClass("is-hidden"),e=t,n="action=newsletterglue_ajax_get_onboarding_settings&security="+newsletterglue_params.ajaxnonce+"&api="+e,l.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:n,success:function(e){e&&(l(".ngl-modal:visible").prepend(e),l(".ngl-boarding-next").removeClass("disabled").addClass("ready"))}}))}function s(){l(".ngl-modal-overlay").addClass("off")}function r(){var e,n=l(".ngl-metabox");0!=n.length&&(l(".ngl-settings").length||(e=!0,n.find("input[type=text].is-required").each(function(){""==l(this).val()||l(this).attr("data-force-unready")?(e=!1,l(this).closest(".ngl-metabox-flex").addClass("is-error")):l(this).closest(".ngl-metabox-flex").removeClass("is-error")}),n.find(".dropdown.is-required").each(function(){""==l(this).dropdown("get value")?(e=!1,l(this).closest(".ngl-metabox-flex").addClass("is-error")):l(this).closest(".ngl-metabox-flex").removeClass("is-error")}),e?(l(".ngl-ready").removeClass("is-hidden"),l(".ngl-not-ready").addClass("is-hidden"),l(".editor-post-publish-button__button.is-primary").removeAttr("disabled"),l(".ngl-newsletter-errors").remove(),l(".ngl-top-checkbox").removeClass("disable-send")):(l(".ngl-ready").addClass("is-hidden"),l(".ngl-not-ready").removeClass("is-hidden"),l(".editor-post-publish-button__button.is-primary").attr("disabled","disabled"),0==l(".ngl-newsletter-errors").length&&l(".edit-post-header__settings").prepend('<span class="ngl-newsletter-errors">'+newsletterglue_params.publish_error+"</span>"),l(".ngl-top-checkbox").addClass("disable-send")),l("#ngl_send_newsletter").is(":checked")||(l(".ngl-newsletter-errors").remove(),l(".editor-post-publish-button__button.is-primary").removeAttr("disabled"),l(".ngl-top-checkbox").removeClass("disable-send"))))}l(".ngl .ui.dropdown, .ngl-metabox .ui.dropdown").dropdown({onChange:function(){r()}}),l(".ngl .ui.checkbox").checkbox(),l(".ngl-date").flatpickr({enableTime:!0,dateFormat:"Y-m-d H:i:s",altInput:!0,enableSeconds:!0,altFormat:"H:i:s, Y/m/d",minDate:"today",onChange:function(){r()}}),l(document).on("click",".ngl-card-add",function(e){l(this).addClass("ngl-hidden"),l(".ngl-card-base").removeClass("ngl-hidden")}),l(".ngl-app").dropdown("setting","onChange",function(e){l(this).parents(".ngl-card-base").addClass("ngl-hidden"),l(".ngl-card-"+e).removeClass("ngl-hidden"),t=e}),l(document).on("click",".ngl-back",function(e){var n;a?l(this).parent().parent().addClass("ngl-hidden"):(n=l(this).attr("data-screen"),l(".ngl-app").dropdown("clear"),l(this).parent().parent().addClass("ngl-hidden"),l("."+n).removeClass("ngl-hidden"))}),l(document).on("submit",".ngl-fields form",function(e){e.preventDefault();var n=l(this),t=l(this).parents(".ngl-card-add2").attr("data-app"),a=n.serialize()+"&action=newsletterglue_ajax_connect_api&security="+newsletterglue_params.ajaxnonce+"&app="+t,s=!1;return l(".ngl-card-"+t).hasClass("ngl-hidden")||n.find("input[type=text]:visible").each(function(){""==l(this).val()&&(l(this).addClass("error").focus(),s=!0)}),s||(i=l.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:a,beforeSend:function(){l(".ngl-card-state.is-testing").removeClass("ngl-hidden"),l(".ngl-card-state.is-invalid").addClass("ngl-hidden")},success:function(e){setTimeout(function(){"invalid"===e.response&&(l(".ngl-card-state.is-testing").addClass("ngl-hidden"),l(".ngl-card-state.is-invalid").removeClass("ngl-hidden")),"successful"===e.response&&o()},1e3)}})),!1}),l(document).on("click",".ngl-ajax-stop-test",function(e){return e.preventDefault(),l(this).parents(".ngl-card-state").addClass("ngl-hidden"),i.abort(),!1}),l(document).on("click",".ngl-ajax-test-connection",function(e){return e.preventDefault(),t=l(this).parents(".ngl-card-view").attr("data-app"),l(".ngl-card-add2.ngl-card-"+t+" .ngl-fields form").trigger("submit"),!1}),l(document).on("click",".ngl-ajax-test-again",function(e){return e.preventDefault(),l(".ngl-card-add2 .ngl-fields form").trigger("submit"),!1}),l(document).on("click",".ngl-ajax-test-close",function(e){return e.preventDefault(),l(".ngl-card-state.is-invalid").addClass("ngl-hidden"),!1}),l(document).on("click",".ngl-ajax-edit-connection",function(e){return e.preventDefault(),l(".ngl-card-state.is-invalid").addClass("ngl-hidden"),l(this).parents(".ngl-card-view").is(":visible")&&(t=l(this).parents(".ngl-card-view").attr("data-app"),a=l(this).parents(".ngl-card-view-"+t)),l(".ngl-card-add2.ngl-card-"+t).removeClass("ngl-hidden"),!1}),l(document).on("click",".ngl-ajax-remove-connection",function(e){return e.preventDefault(),t=l(this).parents(".ngl-card-view").attr("data-app"),l(".ngl-ajax-remove").attr("data-ngl_app",t),l(".ngl-card-state.confirm-remove").removeClass("ngl-hidden"),!1}),l(document).on("click",".ngl-ajax-remove",function(e){e.preventDefault(),l(".ngl-card-state.confirm-remove").addClass("ngl-hidden"),l(".ngl-card-state.is-removed").removeClass("ngl-hidden"),l(".ngl-app").dropdown("clear");var n="action=newsletterglue_ajax_remove_api&security="+newsletterglue_params.ajaxnonce+"&app="+l(this).attr("data-ngl_app");return l.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:n,success:function(e){setTimeout(function(){l(".ngl-card-add").removeClass("ngl-hidden"),l(".ngl-card-state, .ngl-card-add2, .ngl-card-view").addClass("ngl-hidden")},2e3)}}),!1}),l(document).on("change","#ngl_send_newsletter",function(){l(this).is(":checked")?(l(".ngl-top-checkbox").hasClass("is-hidden")&&l(".ngl-top-checkbox").removeClass("is-hidden"),l(".ngl-metabox-if-checked").removeClass("is-hidden"),l("#ngl_send_newsletter2").prop("checked",!0)):(l(".ngl-metabox-if-checked").addClass("is-hidden"),l("#ngl_send_newsletter2").prop("checked",!1)),r()}),l(document).on("change","#ngl_send_newsletter2",function(){l(this).is(":checked")?l("#ngl_send_newsletter").prop("checked",!0).trigger("change"):l("#ngl_send_newsletter").prop("checked",!1).trigger("change")}),l(document).on("change","#newsletter_glue_metabox #ngl_from_email",function(){var e,n,t;e=l("#ngl_from_email").val(),n=l("#ngl_app").val(),t="action=newsletterglue_ajax_verify_email&security="+newsletterglue_params.ajaxnonce+"&email="+e+"&app="+n,l.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:t,beforeSend:function(){l(".ngl-process").addClass("is-hidden"),l(".ngl-process.is-waiting").removeClass("is-hidden")},success:function(e){l(".ngl-process").addClass("is-hidden"),e.success||!0===e?(e.success&&(l(".ngl-process.is-valid").removeClass("is-hidden"),l(".ngl-process.is-valid .ngl-process-text").html(e.success)),l("#ngl_from_email").parent().parent().parent().removeClass("is-error"),l("#ngl_from_email").removeAttr("data-force-unready")):(l(".ngl-process.is-invalid").removeClass("is-hidden"),l(".ngl-process.is-invalid .ngl-process-text").html(e.failed),l("#ngl_from_email").parent().parent().parent().addClass("is-error"),l("#ngl_from_email").attr("data-force-unready",!0)),r()}})}),l(".ngl-metabox input[type=text].js-limit").each(function(e,n){var t=l(this).val();l(this).attr("data-value",t),30<t.length?l(this).parent().find(".ngl-limit").show():l(this).parent().find(".ngl-limit").hide()}),l(document).on("focus",".ngl-metabox input[type=text].js-limit",function(e){l(this).parent().find(".ngl-limit").hide()}),l(document).on("click",".ngl-metabox .ngl-limit",function(e){l(this).parents(".ui.input").find(".js-limit").focus()}),l(document).on("blur",".ngl-metabox input[type=text].js-limit",function(e){var n=l(this).val();l(this).attr("data-value",n),30<n.length?l(this).parent().find(".ngl-limit").show():l(this).parent().find(".ngl-limit").hide()}),l(document).on("change",".ngl-metabox input[type=text]",function(){r()}),l(document).on("blur",".editor-post-title__input",function(){l(this).val()&&""==l("#ngl_subject").val()&&l("#ngl_subject").val(l(this).val()).trigger("change")}),l(document).on("click",".ngl-review-link",function(e){l.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:"action=newsletterglue_clicked_review_button&security="+newsletterglue_params.ajaxnonce})}),l(document).on("click",".ngl-reset-newsletter",function(e){e.preventDefault();var n=l(this),t=l(this).attr("data-post_id"),a="action=newsletterglue_ajax_reset_newsletter&security="+newsletterglue_params.ajaxnonce+"&post_id="+t;return l.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:a,beforeSend:function(){n.addClass("loading")},success:function(e){n.removeClass("loading"),l(".ngl-reset, .ngl-msgbox-wrap").addClass("is-hidden"),l(".ngl-send").removeClass("is-hidden"),l("#ngl_send_newsletter").is(":checked")||l("#ngl_send_newsletter").trigger("click")}}),!1}),l(document).on("click",".ngl-test-email",function(e){e.preventDefault();var n=l(this),t=l(this).attr("data-post_id"),a=n.parents(".ngl-metabox"),s="action=newsletterglue_ajax_test_email&security="+newsletterglue_params.ajaxnonce+"&post_id="+t;return a.find("input[type=text], select, input[type=hidden]").each(function(){s=s+"&"+l(this).attr("id")+"="+encodeURIComponent(l(this).val())}),a.find("input[type=checkbox]").each(function(){l(this).is(":checked")&&(s=s+"&"+l(this).attr("id")+"=1")}),l.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:s,beforeSend:function(){l(".ngl-is-default").hide(),l(".ngl-is-sending").show(),l(".ngl-test-result").hide()},success:function(e){l(".ngl-is-sending").hide(),l(".ngl-action-link").show(),e.success?(l(".ngl-is-valid").show(),l(".ngl-test-result.ngl-is-valid").show().html(e.success)):(l(".ngl-is-invalid").show(),l(".ngl-test-result.ngl-is-invalid").show().html(e.fail))}}),!1}),l(document).on("click",".ngl-retest",function(e){return e.preventDefault(),l(".ngl-action-link, .ngl-action button, .ngl-is-valid, .ngl-is-invalid").hide(),l(".ngl-is-default").show(),!1}),l(document).on("click",".ngl-newsletter-errors a",function(e){return e.preventDefault(),l(".ngl-metabox .is-error").find("input:first").focus(),!1}),l(document).on("click",".ngl-modal-log",function(e){return e.preventDefault(),function(e){l(".ngl-modal-overlay").removeClass("off");var n=e.parents("td");l(".ngl-modal-content").html(n.find(".ngl-modal-contents").html())}(l(this)),!1}),l(document).on("click",".ngl-modal-close",function(e){return e.preventDefault(),s(),!1}),l(document).on("click",".ngl-modal-overlay:not(.onboarding)",function(e){return e.preventDefault(),s(),!1}),l(document).on("click",".ngl-modal",function(e){e.stopPropagation()}),l(document).on("click",".editor-post-publish-button",function(e){var n=l(".ngl-send");l(".ngl-reset-newsletter").is(":visible")&&l("#ngl_send_newsletter, #ngl_send_newsletter2").prop("checked",!1),n.find("#ngl_send_newsletter").is(":checked")&&(n.addClass("is-hidden"),l(".ngl-msgbox-wrap").removeClass("is-hidden"),l(".ngl-top-checkbox").addClass("is-hidden"))}),l(document).delegate(".ngl-textarea","keydown",function(e){var n,t;9==(e.keyCode||e.which)&&(e.preventDefault(),n=this.selectionStart,t=this.selectionEnd,l(this).val(l(this).val().substring(0,n)+"\t"+l(this).val().substring(t)),this.selectionStart=this.selectionEnd=n+1)}),l(document).on("click",".ngl-settings-save:not(.saved)",function(e){return e.preventDefault(),l(".ngl-settings input[type=text], .ngl-settings textarea, .ngl-settings input[type=checkbox], .ngl-settings select").trigger("change"),!1}),l(document).on("change",".ngl-settings input[type=text], .ngl-settings textarea, .ngl-settings input[type=checkbox], .ngl-settings select, .ngl-boarding .ngl-metabox-segment select",function(){var n,t,a,e,s;l("body").find(".ngl-theme").length||(n=l(this).parents(".ngl-ajax-field"),t=l(".ngl-settings-save"),a=l(this).attr("id"),e=l(this).val(),l(this).is(":checkbox")&&(e=l(this).is(":checked")?1:0),e=encodeURIComponent(e),s="action=newsletterglue_ajax_save_field&security="+newsletterglue_params.ajaxnonce+"&id="+a+"&value="+e,l.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:s,beforeSend:function(){n.find(".ngl-process").addClass("is-hidden"),n.find(".ngl-process.is-waiting").removeClass("is-hidden"),t.html(newsletterglue_params.saving),"ngl_from_email"==a&&l(".ngl-boarding").length&&l(".ngl-boarding-next").addClass("disabled")},success:function(e){t.addClass("saved").html(newsletterglue_params.saved),setTimeout(function(){t.removeClass("saved").html(newsletterglue_params.save)},2e3),n.find(".ngl-process").addClass("is-hidden"),e.failed?(n.find(".ngl-process.is-invalid").removeClass("is-hidden"),n.find(".ngl-process.is-invalid .ngl-process-text").html(e.failed),n.parent().parent().addClass("is-error")):e.success?(n.find(".ngl-process.is-valid").removeClass("is-hidden"),n.find(".ngl-process.is-valid .ngl-process-text").html(e.success),n.parent().parent().removeClass("is-error")):(n.parent().parent().removeClass("is-error"),n.find(".ngl-process.is-valid").removeClass("is-hidden"),setTimeout(function(){n.find(".ngl-process").addClass("is-hidden")},1500)),n.parent().parent().hasClass("is-error")||"ngl_from_email"==a&&l(".ngl-boarding").length&&setTimeout(function(){l(".ngl-boarding-next").removeClass("disabled").addClass("ready")},1500)}}))}),l(document).on("click",".ngl-block-useall",function(e){return e.preventDefault(),l(".ngl-block").each(function(){l(this).removeClass("ngl-block-unused").addClass("ngl-block-used"),l(this).find("input[type=checkbox]").prop("checked",!0)}),l.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:"action=newsletterglue_ajax_use_all_blocks&security="+newsletterglue_params.ajaxnonce}),!1}),l(document).on("click",".ngl-block-disableall",function(e){return e.preventDefault(),l(".ngl-block").each(function(){l(this).removeClass("ngl-block-used").addClass("ngl-block-unused"),l(this).find("input[type=checkbox]").prop("checked",!1)}),l.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:"action=newsletterglue_ajax_disable_all_blocks&security="+newsletterglue_params.ajaxnonce}),!1}),l(document).on("change",".ngl-block-use input[type=checkbox]",function(e){var n,t=l(this).attr("id");l(this).is(":checked")?(n="yes",l(this).parents(".ngl-block").removeClass("ngl-block-unused").addClass("ngl-block-used")):(n="no",l(this).parents(".ngl-block").removeClass("ngl-block-used").addClass("ngl-block-unused")),l.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:"action=newsletterglue_ajax_use_block&security="+newsletterglue_params.ajaxnonce+"&id="+t+"&value="+n})}),l(document).on("click",".ngl-block-demo",function(e){e.preventDefault();var n=l(this).parents(".ngl-block").attr("data-block");return l(".ngl-popup-overlay").addClass("ngl-active"),l("body").addClass("ngl-popup-hidden"),l(".ngl-popup-overlay.ngl-active").find(".ngl-popup-panel").empty(),l(".ngl-popup-demo[data-block="+n+"]").appendTo(l(".ngl-popup-overlay.ngl-active").find(".ngl-popup-panel")),l(".ngl-popup-overlay.ngl-active").addClass("ngl-popup-overlay-demo"),l(".ngl-popup-overlay.ngl-active").removeClass("ngl-popup-overlay-settings"),!1}),l(document).on("click",".ngl-block-defaults a",function(e){e.preventDefault();var n=l(this).parents(".ngl-block").attr("data-block");return l(".ngl-popup-overlay").addClass("ngl-active"),l("body").addClass("ngl-popup-hidden"),l(".ngl-popup-overlay.ngl-active").find(".ngl-popup-panel").empty(),l(".ngl-popup-settings[data-block="+n+"]").appendTo(l(".ngl-popup-overlay.ngl-active").find(".ngl-popup-panel")),l(".ngl-popup-overlay.ngl-active").removeClass("ngl-popup-overlay-demo"),l(".ngl-popup-overlay.ngl-active").addClass("ngl-popup-overlay-settings"),!1}),l(document).on("click",".ngl-popup-panel",function(e){e.stopPropagation()}),l(document).on("click",function(){n()}),l(document).on("click",".ngl-popup-close",function(e){e.preventDefault(),n()}),l(document).on("change",".ngl-popup-settings input[type=checkbox]",function(e){var n=l(this).parents(".ngl-popup-settings").attr("data-block"),t=l(this).parents("form").serialize()+"&action=newsletterglue_ajax_save_block&security="+newsletterglue_params.ajaxnonce+"&id="+n;l.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:t,success:function(e){}})}),l(document).on("change",".ngl-settings-mailchimp #ngl_audience, .ngl-mb-mailchimp #ngl_audience",function(e){}),l(window).on("load",function(){l("#ngl_send_newsletter").length&&l(".edit-post-header__settings").prepend('<div class="ngl-top-checkbox is-hidden"><label><input type="checkbox" name="ngl_send_newsletter2" id="ngl_send_newsletter2" value="1">'+newsletterglue_params.send_newsletter+"</label></div>")})}(jQuery);